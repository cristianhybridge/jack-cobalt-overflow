{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="card mb-3">

    <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
            <a href="{{ url_for('home') }}" class="btn btn-info mb-3">Regresar</a>
            <div>
            {% if post.created_by == user.user_id %}
            <p class="badge rounded-pill" style="background:blue; color:white;"><strong>Tú</strong></p>
            {% endif %}
            {% if post.expiration_date < current_time() %}
            <p class="badge rounded-pill" style="background:red; color:white;"><strong>Terminó</strong></p>
            {% else %}
            <p class="badge rounded-pill" style="background:green; color:white;"><strong>Pendiente</strong></p>
            {% endif %}
            </div>
        </div>
        
        <div class="d-flex justify-content-between align-items-start">
            <h5 class="card-title">{{ post.title }}</h5>
            {% if post.created_by == user.user_id %}
            <form action="/api/post/{{ post.post_id }}" method="post">
                <input type="hidden" name="_method" value="DELETE">
                <button type="submit" style="background: none; border: none; cursor: pointer; padding: 0;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                        <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                    </svg>
                </button>
            </form>
            {% endif %}
        </div>
        <p class="card-text">{{ post.commentary }}</p>
        {% if post.created_by == user.user_id %}
        <p style="margin-bottom: 0;"><strong>Autor: <i style="color:blue;">{{ post.creator }}<small style="color:darkred;"> (Tú)</small></i></strong></p>
        {% else %}
        <p style="margin-bottom: 0;"><strong>Autor: <i style="color:rebeccapurple;">{{ post.creator }}</i></strong></p>
        {% endif%}
        

        <p>{% if post.affected_area %}<strong>Área:</strong> {{ post.affected_area }}{% endif %}</p>

        {% if post.expiration_date < current_time() %}
            <p style="margin-bottom: 0; color: red;"><strong>Terminó el:</strong> {{ post.expiration_date.strftime('%b %d, %Y') }}</p>
        {% else %}
            <p style="margin-bottom: 0; color: darkgreen;"><strong>Vencimiento:</strong> {{ post.expiration_date.strftime('%b %d, %Y') }}</p>
        {% endif %}
        <p><strong>Prioridad:</strong> {{ post.priority }}</p>
        <p style="margin-bottom: 0;"><small>{{ post.creation_date.strftime('%b %d, %Y - %I:%M %p') }}</small></p>
        <p><small><i>{{ post.time_since_creation }}</i></small></p>
        <div class="d-flex align-items-center">
<!--            <p class="mb-1" style="cursor: pointer;">-->
<!--                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cup-hot-fill" viewBox="0 0 16 16">-->
<!--                    <path fill-rule="evenodd" d="M.5 6a.5.5 0 0 0-.488.608l1.652 7.434A2.5 2.5 0 0 0 4.104 16h5.792a2.5 2.5 0 0 0 2.44-1.958l.131-.59a3 3 0 0 0 1.3-5.854l.221-.99A.5.5 0 0 0 13.5 6zM13 12.5a2 2 0 0 1-.316-.025l.867-3.898A2.001 2.001 0 0 1 13 12.5"/>-->
<!--                    <path d="m4.4.8-.003.004-.014.019a4 4 0 0 0-.204.31 2 2 0 0 0-.141.267c-.026.06-.034.092-.037.103v.004a.6.6 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.2.22.455.22.745 0 .188-.065.368-.119.494a3 3 0 0 1-.202.388 5 5 0 0 1-.253.382l-.018.025-.005.008-.002.002A.5.5 0 0 1 3.6 4.2l.003-.004.014-.019a4 4 0 0 0 .204-.31 2 2 0 0 0 .141-.267c.026-.06.034-.092.037-.103a.6.6 0 0 0-.09-.252A4 4 0 0 0 3.6 2.8l-.01-.012a5 5 0 0 1-.37-.543A1.53 1.53 0 0 1 3 1.5c0-.188.065-.368.119-.494.059-.138.134-.274.202-.388a6 6 0 0 1 .253-.382l.025-.035A.5.5 0 0 1 4.4.8m3 0-.003.004-.014.019a4 4 0 0 0-.204.31 2 2 0 0 0-.141.267c-.026.06-.034.092-.037.103v.004a.6.6 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.2.22.455.22.745 0 .188-.065.368-.119.494a3 3 0 0 1-.202.388 5 5 0 0 1-.253.382l-.018.025-.005.008-.002.002A.5.5 0 0 1 6.6 4.2l.003-.004.014-.019a4 4 0 0 0 .204-.31 2 2 0 0 0 .141-.267c.026-.06.034-.092.037-.103a.6.6 0 0 0-.09-.252A4 4 0 0 0 6.6 2.8l-.01-.012a5 5 0 0 1-.37-.543A1.53 1.53 0 0 1 6 1.5c0-.188.065-.368.119-.494.059-.138.134-.274.202-.388a6 6 0 0 1 .253-.382l.025-.035A.5.5 0 0 1 7.4.8m3 0-.003.004-.014.019a4 4 0 0 0-.204.31 2 2 0 0 0-.141.267c-.026.06-.034.092-.037.103v.004a.6.6 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.2.22.455.22.745 0 .188-.065.368-.119.494a3 3 0 0 1-.202.388 5 5 0 0 1-.252.382l-.019.025-.005.008-.002.002A.5.5 0 0 1 9.6 4.2l.003-.004.014-.019a4 4 0 0 0 .204-.31 2 2 0 0 0 .141-.267c.026-.06.034-.092.037-.103a.6.6 0 0 0-.09-.252A4 4 0 0 0 9.6 2.8l-.01-.012a5 5 0 0 1-.37-.543A1.53 1.53 0 0 1 9 1.5c0-.188.065-.368.119-.494.059-.138.134-.274.202-.388a6 6 0 0 1 .253-.382l.025-.035A.5.5 0 0 1 10.4.8"/>-->
<!--                </svg>-->
<!--            </p>-->
<!--            <p class="mb-0 ms-1"><small>: {{ post.votes }}</small></p>-->
                <p class="mb-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-left-dots" viewBox="0 0 16 16">
                        <path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                        <path d="M5 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                    </svg>
                </p>
                <p class="mb-0 ms-1"><small>: {{ post.comments_count }}</small></p>
        </div>
        {% for item in post_comments %}
        <div class="card mb-2 mt-2">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <p class="mb-0">
                        {% if (item.created_by == post.created_by) and (item.created_by == user.user_id) %}
                        <strong style="color:blue;">{{ item.creator }}<small style="color:black;"> <i style="color:darkred;">(Tú)</i> (Autor)</small></strong> |
                        {% elif (item.created_by == post.created_by) %}
                        <strong style="color:rebeccapurple;">{{ item.creator }}<small style="color:black;"> (Autor)</small></strong> |
                        {% elif (item.created_by == user.user_id) %}
                        <strong style="color:blue;">{{ item.creator }}</strong> |
                        {% else %}
                        <strong style="color:rebeccapurple;">{{ item.creator }}</strong> |
                        {% endif %}
                        <small>{{ item.creation_date.strftime('%b %d, %Y - %I:%M:%S %p') }}</small> |
                        <small><i>{{ item.time_since_creation }}</i></small>
                    </p>
                    {% if user %}
                        {% if item.created_by == user.user_id %}
                        <form action="/api/post-comment/{{ item.post_comment_id }}" method="post">
                            <input type="hidden" name="_method" value="DELETE">
                            <button type="submit" style="background: none; border: none; cursor: pointer; padding: 0;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                                </svg>
                            </button>
                        </form>
                        {% endif %}
                    {% endif %}
                </div>
                <p class="card-text mt-2">{{ item.commentary }}</p>
            </div>
        </div>
        {% endfor %}
        {% if user %}
        <form action="/api/post-comment" method="post">
            <div class="d-flex mb-2 mt-4">
                <textarea name="commentary" class="form-control me-2" placeholder="Escribe algo..."></textarea>
                <button type="submit" class="btn btn-info" style="align-content: center">Enviar</button>
            </div>

            <input type="hidden" name="created_by" value="1">
            <input type="hidden" name="post_id" value="{{ post.post_id }}">
        </form>
        {% endif %}
    </div>
</div>
{% endblock %}
